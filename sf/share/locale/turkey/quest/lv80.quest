----------------------------------------------------
--COLLECT QUEST_lv80
--METIN2 Collecting Quest
----------------------------------------------------
quest collect_quest_lv80  begin
        state start begin
        end
        state run begin
                when login or levelup with pc.level >= 80 begin
                        set_state(information)
                end
        end

        state information begin
                when letter begin
                        local v = find_npc_by_vnum(20084)
                        if v != 0 then
                                target.vid("__TARGET__", v, "Chaegirap")
                        end
                        send_letter("Chaegirab'ýn isteði")
                end

                when button or info begin
						say_title("Chaegirab'ýn isteði")
                        say("")
                        say("Uriel'in öðrencisi Biyolog Chaegirab'ýn")
                        say("acil olarak yardýmýna ihtiyacý var.")
                        say("Haydi, onun yanýna git ve yardým et.")
                        say("")
                end

                when __TARGET__.target.click or
                        20084.chat."Tugyis Tabelasý " begin
                        target.delete("__TARGET__")
                        say_title("Biyolog Chaegirab:")                                    
                    	say("Merhaba. Seni tekrar gördüðüme sevindim.")
                        say("Þu aralar Yýlan Vadisi hakkýnda")
                        say("yazýyorum. Aslýnda bunu kendim baþarmam")
                        say("gerekiyor, ama tek baþýma baþaramam....Benim için")
                        say("bunu yapar mýsýn? Tabii ki, yardýmlarýn")
                        say("karþýlýðýnda çok iyi ödüllendirileceksin.")
                        wait()
                        say_title("Biyolog Chaegirab:")
                        say("Gayretini takdir ediyorum. ")
                        say("Daha önce Yýlan Vadisi'ni hiç duydun")
                        say("mu? Yüksek daðlar ve çöllerden oluþan bir alan.")
                        say("Esrarengiz sýlahlarý ve zýrhlarý ile vadiyi")
                        say("koruyan gerçekten korkunç hayaletler var.")
                        say("Bunlar dev gibi ve çok güçlü hayaletler.")
                        say("Beni ilgilendir kýsmý, doguþtan savasçý hayaleti")
                        say("olaný... Lütfen bana bu hayalet savasçý")
                        say("hakkýnda bir kanýt getir.")
                        say("")
                        wait()
                        say_title("Biyolog Chaegirab:")
						say("")
                        say("Bu mümkün mü?")
                        say("Orada þu anda bir çok sahte kanýt var. Sahteleri")
                        say("kullanamam...")
                        say("30 Tugyis Tabelasýna ihtiyacým var.")
                        say("Bol þanslar!")
                        say("")
                        set_state(go_to_disciple)
                        pc.setqf("duration",0)  
                        pc.setqf("collect_count",0)
                        pc.setf("collect_quest_luck","drink_drug",0)
			end
        end
        state go_to_disciple begin
                when letter begin
                        send_letter("Biyolog'un araþtýrmasý ")

                end
                when button or info begin
                        say_title("Devler Diyarýndan Tugyis Tabelasý ")
                        say("Uriel'in çýraðý Chaegirab, Yýlan " )
                        say("Vadisindeki Dev Savasçýlarý inceliyor.")
                        say("Bu dev savasçýlar karþý konulmaz güçleriyle")
                        say("tanýnýyorlar. Bu hayaletlerden Chaegirab'a 30")
                        say("Tugyis Tabelasý getirmen gerekiyor.")
                        say_item_vnum(30166)
                        say_reward("Þimdiye kadar "..pc.getqf("collect_count").." tabela topladýn.")
                end


		when 1401.kill or
			 1402.kill or
			 1403.kill or
			 1601.kill or 
			 1602.kill or
			 1603.kill  begin
                        local s = number(1,100)
                        if s <= 5 then
                                pc.give_item2(30166,1)
                  send_letter(""..item_name(30166).." buldun.")
			end	
		end


            when 20084.chat."Tugyis Tabelasý " with pc.count_item(30166) >0   begin
                        if get_time() > pc.getqf("duration") then
                                say_title("Biyolog Chaegirab: ")
								say("Ah, bir tane bulmuþsun.")
                                say("Biraz bekle de kontrol edeyim...")
                                pc.remove_item("30166", 1)
								if  is_test_server()  then 
									pc.setqf("duration",get_time()+1) 
								else
									pc.setqf("duration",get_time()+1) -----------------------------------22½Ã°£
								end
                                wait()
                                
								local pass_percent
								if pc.is_gm() then
								pass_percent =100
								else
									if pc.getf("collect_quest_luck","drink_drug")==0 then
                                        pass_percent=40
									else
                                        pass_percent=80
									end
                                end

                                local s= number(1,100)
                                if s<= pass_percent  then
                                   if pc.getqf("collect_count")< 29 and not pc.is_gm() then     --weniger als 30
                                                local index =pc.getqf("collect_count")+1
                                                pc.setqf("collect_count",index)                                                     
												say_title("Biyolog Chaegirab:")
                                                say("Ah! Bu Tugyis Tabelasý en iyi kalite! Hemen ")
                                                say("araþtýrmaya baþlayacaðým. Ancak "..30-pc.getqf("collect_count").." tane daha")
                                                say("lazým. Lütfen bulmaya çalýþ!")
                                                say("Ve zamana ihtiyacým olduðunu unutma. Yarýna kadar")
												say("baþka bir Tugyis Tabelasý inceleyemem.")
                                                pc.setf("collect_quest_luck","drink_drug",0)                                                     
												return
                                        end
                                        say_title("Biyolog Chaegirab:")
                                        say("30 delili de topladýn!!")
                                        say("Geriye sadece hayalet savasçýlarýnýn Ruh")
                                        say("Taþý'ný almak kaldý, bu anahtar görevi yapacak.")
                                        say("Ruh Taþý'ný vadideki hayalet savasçýlardan")
                                        say("kazanabilirsin. Bunu benim için")
                                        say("yapar misin?")
                                        say("")
                                        pc.setqf("collect_count",0)
                                        pc.setf("collect_quest_luck","drink_drug",0)
                                        pc.setqf("duration",0)
                                        set_state(key_item)
                                        return
                                else
                                say_title("Biyolog Chaegirab:")
                                say("Hmm..Bu yanlýþ...")
                                say("Üzgünüm, bunu kullanamam.")
                                say("Bu taþýn içinde farklý güçler olabilir.")
                                say("Lütfen, baþka bir tane bul.")
                                say("")
                                pc.setf("collect_quest_luck","drink_drug",0)                                        
								return
                                end
                  else
                  say_title("Biyolog Chaegirab:")                                                
                  say("Son derece üzgünüm...")
                  say("Henüz bana getirdiðin diðer tabelayý ")
                  say("incelemeyi bitirmedim.....")
                  say("Hmm, çok üzgünüm....Diðerini daha sonra ")
                  say("getirebilir misin?")
                  return
                end

end
end


        state key_item begin
                when letter begin
                        send_letter("Biyolog'un araþtýrmasý ")

                        if pc.count_item(30225)>0 then
                                local v = find_npc_by_vnum(20084)
                                if v != 0 then
                                        target.vid("__TARGET__", v, "Chaegirap")
                                end
                        end

                end
                when button or info begin
                        if pc.count_item(30225) >0 then
                                say_title("Tugyinin Ruh Taþý ")
                                say("Sonunda Tugyinin Ruh Taþýný buldun! Onu ")
                                say("biyolog Chaegirab'a götür. Seni bekliyor.")
                                return
                        end

                        say_title("Tugyinin Ruh Taþý ")
                        say("")
                        ---                                                   l
                        say("Uriel'in çýraðý Chaegirab'ýn araþtýrmasý için ")
                        say("hayalet savasçýlara ait 30 Tugyis Tabelasý topladýn.")
                        say("Son olarak ihtiyaç duyulan Tugyinin Ruh Taþý.")
                        say_item_vnum(30225)
                        say("Onu Yýlan Vadisindeki hayalet savasçýlardan")
                        say("kazanabilirsin.")
                        say("")
                        say("")
                end


					when 1401.kill or
						 1402.kill or
						 1403.kill or
						 1601.kill or 
						 1602.kill or
						 1603.kill  begin
                        local s = number(1,200)
                        if s==1 then
                                pc.give_item2(30225,1)
                                send_letter("Biyolog'un araþtýrmasý ")
                        end
                end




                when __TARGET__.target.click  or
                        20084.chat."Ruh Taþý'ný buldun." with pc.count_item(30225) > 0  begin
                    target.delete("__TARGET__")
                        say_title("Biyolog Chaegirab:")
						say("Çok teþekkür ederim.")
                        say("Ödül olarak sana bu reçeteyi vereceðim. Ýçeriðini")
                        say("çok kiþi bilmez ve sýrrý dikkatlice saklanýr.")
						say("Bununla yapýlacak iksir saldýrý gücünü ")
                        say("geliþtirecek. Baek-Go'ya git. Senin için bir")
                        say("iksir yapacak. Kendine iyi bak arkadaþým.")
                        say("Yardýmýna teþekkür ederim, sayende Yýlan")
                        say("Vadisindeki devler hakkýnda çok önemli bilgiler")
						say("edindim.")
                        pc.remove_item("30225",1)
                        set_state(__reward)
                end

        end

        state __reward begin
                when letter begin
                        send_letter("Chaegirab'ýn ödülü ")

                        local v = find_npc_by_vnum(20018)
                        if v != 0 then
                                target.vid("__TARGET__", v, "Baek Go")
                        end

                end
                when button or info begin
                        say_title("Chaegirab'ýn ödülü ")
                        ---                                                   l
                        say("Tabelalarýn ve ruh taþýnýn ödülü olarak")
                        say("biyolog Chaegirab sana gizli bir reçete verdi.")
                        say("Þimdi Baek-Go'ya git, senin için mucizevi bir ")
                        say("iksir yapacak.")
                end

                when __TARGET__.target.click  or
                        20018.chat."Gizli Reçete"  begin
                    target.delete("__TARGET__")
                        say_title("Baek-Go:")
						say("Ah, bu biyolog Chaegirab'ýn gizli reçetesi mi?")
                        say("Hm, bu saldýrý deðerini %10 ve saldýrý hýzýný 6")
                        say("puan artýracak. Ýþte iksirin!")
                        wait()
                        say_title("Baek-Go:")
						say("Ayný zamanda sana bu Mavi Abanoz Sandýðý da")
                        say("vermeliyim. Ona iyi bak.")
                        say_reward("Chagirab'ýn isteðini tamamladýðýn için kalýcý ")
                        say_reward("olarak saldýrý deðerin %10 ve saldýrý hýzýn 6")
                        say_reward("puan arttý.")
						affect.remove_collect(apply.ATT_SPEED, 5, 60*60*24*365*60)
                        affect.add_collect(apply.ATT_SPEED,11,60*60*24*365*60) --60Jahre
						affect.add_collect_point(POINT_ATT_BONUS,10,60*60*24*365*60) --60³â	
                        pc.give_item2("50114",1)
						pc.delqf("collect_count")
                        clear_letter()
						set_quest_state("collect_quest_lv85", "run")
                        set_state(__complete)
                end

        end


        state __complete begin
        end
end
